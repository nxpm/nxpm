(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{158:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return o})),t.d(n,"rightToc",(function(){return l})),t.d(n,"default",(function(){return s}));var a=t(2),r=t(11),i=(t(0),t(169)),c={id:"releasing-packages",title:"Releasing packages",sidebar_label:"Releasing packages"},o={id:"guides/releasing-packages",title:"Releasing packages",description:"In this guide we will create a new workspace, add some packages and release them to npm.",source:"@site/docs/guides/releasing-packages.md",permalink:"/docs/guides/releasing-packages",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/guides/releasing-packages.md",sidebar_label:"Releasing packages",sidebar:"someSidebar",previous:{title:"nxpm release",permalink:"/docs/commands/release"},next:{title:"Troubleshooting",permalink:"/docs/troubleshooting"}},l=[{value:"Creating a new workspace",id:"creating-a-new-workspace",children:[]},{value:"Adding a GitHub repository",id:"adding-a-github-repository",children:[]},{value:"Getting a GitHub token",id:"getting-a-github-token",children:[]},{value:"Adding Nx apps and libraries",id:"adding-nx-apps-and-libraries",children:[]},{value:"Building our projects",id:"building-our-projects",children:[]},{value:"Commit and push to GitHub",id:"commit-and-push-to-github",children:[]},{value:"Releasing our libraries",id:"releasing-our-libraries",children:[]}],p={rightToc:l};function s(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"In this guide we will create a new workspace, add some packages and release them to npm."),Object(i.b)("p",null,"The workspace name we will use is ",Object(i.b)("inlineCode",{parentName:"p"},"nxpm-playground"),"."),Object(i.b)("p",null,"For this guide to work, the workspace name should be the name of the npm scope we will use to publish the packages. If you don't have a npm org you can ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.npmjs.com/org/create"}),"create one")," for free."),Object(i.b)("h2",{id:"creating-a-new-workspace"},"Creating a new workspace"),Object(i.b)("p",null,"Open a shell and navigate to the directory where you want to create the project."),Object(i.b)("p",null,"Run the following command to start:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"yarn create nx-workspace nxpm-playground\n")),Object(i.b)("p",null,"When prompted, we select the ",Object(i.b)("inlineCode",{parentName:"p"},"empty")," preset:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"\u276f empty             [an empty workspace]\n  web components    [a workspace with a single app built using web components]\n  angular           [a workspace with a single Angular application]\n  angular-nest      [a workspace with a full stack application (Angular + Nest)]\n  react             [a workspace with a single React application]\n  react-express     [a workspace with a full stack application (React + Express)]\n  next.js           [a workspace with a single Next.js application]\n")),Object(i.b)("p",null,"After that, we select the ",Object(i.b)("inlineCode",{parentName:"p"},"Nx")," CLI:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"? CLI to power the Nx workspace\n\u276f Nx           [Extensible CLI for JavaScript and TypeScript applications]\n  Angular CLI  [Extensible CLI for Angular applications. Recommended for Angular projects.]\n")),Object(i.b)("p",null,"The installation will start and create our project in ",Object(i.b)("inlineCode",{parentName:"p"},"nxpm-playground")),Object(i.b)("h2",{id:"adding-a-github-repository"},"Adding a GitHub repository"),Object(i.b)("p",null,"Once this is done we ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/new"}),"create a new repository")," and add it to the project. This is needed in order to publish the release to GitHub, including the changelog."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"cd nxpm-playground\ngit remote add origin git@github.com:beeman/nxpm-playground.git\n")),Object(i.b)("h2",{id:"getting-a-github-token"},"Getting a GitHub token"),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/settings/tokens/new"}),"Create a personal access token")," with the ",Object(i.b)("inlineCode",{parentName:"p"},"repo")," scope selected."),Object(i.b)("p",null,"We export this token as the ",Object(i.b)("inlineCode",{parentName:"p"},"GITHUB_TOKEN")," environment variable. This gives the ",Object(i.b)("inlineCode",{parentName:"p"},"release")," command access to publish the release."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"export GITHUB_TOKEN=<your-token>\n")),Object(i.b)("h2",{id:"adding-nx-apps-and-libraries"},"Adding Nx apps and libraries"),Object(i.b)("p",null,"Next up we're going to add some Nrwl libraries which we'll use to create some apps and libs:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"yarn add -D @nrwl/angular @nrwl/node\n")),Object(i.b)("p",null,"Once this is done we create our ",Object(i.b)("inlineCode",{parentName:"p"},"web")," and ",Object(i.b)("inlineCode",{parentName:"p"},"api")," apps:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"nx g @nrwl/node:app api\nnx g @nrwl/angular:app web --style scss --routing\n")),Object(i.b)("p",null,"Finally, we will create a library for both of our apps:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"nx g @nrwl/node:lib api-core --publishable\nnx g @nrwl/angular:lib web-core --style scss --publishable\n")),Object(i.b)("div",{className:"admonition admonition-important alert alert--info"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Make sure create your libraries with the ",Object(i.b)("inlineCode",{parentName:"p"},"--publishable")," flag, otherwise the ",Object(i.b)("inlineCode",{parentName:"p"},"release")," command will not recognize them!"))),Object(i.b)("h2",{id:"building-our-projects"},"Building our projects"),Object(i.b)("p",null,"At this point we're ready to build our project and release the packages."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"yarn nx run-many --target build --all\n")),Object(i.b)("p",null,"This will build all the 4 projects in our workspace."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'>  NX  Running target build for projects:\n\n  - api-core\n  - web-core\n  - api\n  - web\n\n.......\n>  NX   SUCCESS  Running target "build" succeeded\n')),Object(i.b)("h2",{id:"commit-and-push-to-github"},"Commit and push to GitHub"),Object(i.b)("p",null,"Currently, the ",Object(i.b)("inlineCode",{parentName:"p"},"release")," command expects a remove branch to exist. If this is not the case, it will fail."),Object(i.b)("p",null,"Let's commit all changes and push them to github:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'git add .\ngit commit -m "feat: initial commit"\ngit push origin master\n')),Object(i.b)("h2",{id:"releasing-our-libraries"},"Releasing our libraries"),Object(i.b)("p",null,"Once this is all in place, we are ready to publish the libraries ",Object(i.b)("inlineCode",{parentName:"p"},"api-core")," and ",Object(i.b)("inlineCode",{parentName:"p"},"web-core")," to npm."),Object(i.b)("p",null,"First we need to install ",Object(i.b)("inlineCode",{parentName:"p"},"nxpm")," as a dev dependency:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"yarn add -D nxpm\n")),Object(i.b)("p",null,"Once that is in place, we will run the ",Object(i.b)("inlineCode",{parentName:"p"},"release")," command in ",Object(i.b)("inlineCode",{parentName:"p"},"dry-run")," mode:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"yarn nxpm release 1.0.0 --dry-run\n")),Object(i.b)("p",null,"Initially, the command will fail with some errors:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),' NXPM  VALIDATE Using nx workspace: workspace.json\n NXPM  VALIDATE Found 2 libraries:\n NXPM  VALIDATE Found builder for api-core: @nrwl/node:package\n NXPM  VALIDATE Found builder for web-core: @nrwl/angular:package\n NXPM  ERROR Version "0.0.1" should be "0.0.0-development" in libs/api-core/package.json\n NXPM  ERROR License not defined in in libs/api-core/package.json\n NXPM  ERROR Version "0.0.1" should be "0.0.0-development" in libs/web-core/package.json\n NXPM  ERROR License not defined in in libs/web-core/package.json\n NXPM  Could not continue because of errors in the following packages:\n[ \'api-core\', \'web-core\' ]\n NXPM  Try running this command with the --fix flag to fix some common problems\n NXPM   ERROR  Error validating packages\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\n')),Object(i.b)("p",null,"Let's use the ",Object(i.b)("inlineCode",{parentName:"p"},"--fix")," flag to have nxpm fix the issues:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),'yarn nxpm release 1.0.0 --dry-run --fix\n NXPM  VALIDATE Using nx workspace: workspace.json\n NXPM  VALIDATE Found 2 libraries:\n NXPM  VALIDATE Found builder for api-core: @nrwl/node:package\n NXPM  VALIDATE Found builder for web-core: @nrwl/angular:package\n NXPM  ERROR Version "0.0.1" should be "0.0.0-development" in libs/api-core/package.json\n NXPM  FIXED Version set to "0.0.0-development" in libs/api-core/package.json\n NXPM  ERROR License not defined in in libs/api-core/package.json\n NXPM  FIXED License set to MIT in libs/api-core/package.json\n NXPM  VALIDATE Package @nxpm-playground/api-core is valid.\n NXPM  ERROR Version "0.0.1" should be "0.0.0-development" in libs/web-core/package.json\n NXPM  FIXED Version set to "0.0.0-development" in libs/web-core/package.json\n NXPM  ERROR License not defined in in libs/web-core/package.json\n NXPM  FIXED License set to MIT in libs/web-core/package.json\n NXPM  VALIDATE Package @nxpm-playground/web-core is valid.\n NXPM  VALIDATE Found 2 packages to release\n')),Object(i.b)("p",null,"After the packages are valid it's time to actually release them."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"yarn nxpm release 1.0.0\n")),Object(i.b)("p",null,"You will be asked several questions, answer all of them with ",Object(i.b)("inlineCode",{parentName:"p"},"Yes")," (or just hit ",Object(i.b)("inlineCode",{parentName:"p"},"enter"),")"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"? Commit (Release 1.0.0)? Yes\n? Tag (1.0.0)? Yes\n? Push? Yes\n? Create a release on GitHub (Release 1.0.0)? Yes\n")),Object(i.b)("p",null,"Once the release is published to github, ",Object(i.b)("inlineCode",{parentName:"p"},"npm publish")," will be executed:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-shell",metastring:"script",script:!0}),"\ud83d\udd17 https://github.com/beeman/nxpm-playground/releases/tag/1.0.0\n\ud83c\udfc1 Done (in 89s.)\nnpm notice\nnpm notice \ud83d\udce6  @nxpm-playground/api-core@1.0.0\nnpm notice === Tarball Contents ===\nnpm notice ...\nnpm notice === Tarball Details ===\nnpm notice name:          @nxpm-playground/api-core\nnpm notice version:       1.0.0\nnpm notice package size:  815 B\nnpm notice unpacked size: 1.1 kB\nnpm notice shasum:        ccd92142c8ca2afcf87af51cc49d8a5ed864d6e4\nnpm notice integrity:     sha512-MNBRRnyrYCNO3[...]hmBRJWKYoEaCQ==\nnpm notice total files:   8\nnpm notice\n+ @nxpm-playground/api-core@1.0.0\nnpm WARN lifecycle The node binary used for scripts is /var/folders/rr/n45jfj7130x1vdvcv4dywpvc0000gn/T/yarn--1589448482284-0.49769534594014986/node but npm is using /usr/local/Cellar/node@12/12.16.2_1/bin/node itself. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.\n\n> @nxpm-playground/web-core@1.0.0 prepublishOnly .\n> true\n\nnpm notice\nnpm notice \ud83d\udce6  @nxpm-playground/web-core@1.0.0\nnpm notice === Tarball Contents ===\nnpm notice ...\nnpm notice === Tarball Details ===\nnpm notice name:          @nxpm-playground/web-core\nnpm notice version:       1.0.0\nnpm notice package size:  2.9 kB\nnpm notice unpacked size: 11.9 kB\nnpm notice shasum:        32f6bb1ed1cd30105f22a329a4352bb2f0d3b625\nnpm notice integrity:     sha512-p7tF1BecQJXQ1[...]e7szdOYGqZSqQ==\nnpm notice total files:   25\nnpm notice\n+ @nxpm-playground/web-core@1.0.0\n NXPM  SUCCESS It looks like we're all done here! :)\n")),Object(i.b)("p",null,"Aaaand we're done! You can check the resulting packages\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.npmjs.com/package/@nxpm-playground/api-core"}),"api-core")," and\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.npmjs.com/package/@nxpm-playground/api-web"}),"api-web"),"."),Object(i.b)("p",null,"If you get stuck, feel free to ping me on ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://discord.gg/RTgCpDd"}),"discord")," or the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://join.slack.com/t/nrwlcommunity/shared_invite/zt-9oqftflu-gcpO8xpMCdBhxUWmtuwr~g"}),"Nrwl Community Slack"),"."))}s.isMDXComponent=!0},169:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=r.a.createContext({}),s=function(e){var n=r.a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o({},n,{},e)),t},b=function(e){var n=s(e.components);return r.a.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},u=Object(a.forwardRef)((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),b=s(t),u=a,m=b["".concat(c,".").concat(u)]||b[u]||d[u]||i;return t?r.a.createElement(m,o({ref:n},p,{components:t})):r.a.createElement(m,o({ref:n},p))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,c=new Array(i);c[0]=u;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,c[1]=o;for(var p=2;p<i;p++)c[p]=t[p];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);